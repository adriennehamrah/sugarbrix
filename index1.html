<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>SugarBrix</title>
    <link rel="stylesheet" type="text/css" href="stylesheets/application.css">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="data/food.json"></script>
    <script src="data/benchmarks.json"></script>
    <link rel="icon"
      href="https://res.cloudinary.com/adrienne/image/upload/c_scale,w_30/v1507178537/sugarbrix/sugar_cubes_dark.png">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
  </head>
  <body>
    <script>
    const svg = d3.select("body").append("svg")
      .attr("class", "chart-box-svg")


      const table = d3.select("svg").append("xhtml:table");
      const thead = table.append("thead");
      const tbody = table.append("tbody");

      const tr = tbody.selectAll("tr")
        .data(food)
        .enter()
        .append("tr");

      tr.exit()
        .remove();

      tr.append("td").html(f => {return f.name; })
        .attr("class", "name");

      tr.append("td")
        .append("img")
        .attr("class", "food-img")
        .attr('src', f => {return f.img_url; })
        .attr("width", "65")
        .attr("height", "55");

      tr.append("td")
        .append("img")
        .attr("class", "equal")
        .attr("src", "https://res.cloudinary.com/adrienne/image/upload/v1507140911/sugarbrix/equal_sign.png")
        .attr("width", "45")
        .attr("height", "25");

      tr.append("defs")
        .append("pattern")
        .attr("id", "bg")
        .attr("patternUnits", "userSpaceOnUse")
        .attr("width", "50")
        .attr("height", "50")
        .append("image")
        .attr("xlink:href", "https://res.cloudinary.com/adrienne/image/upload/v1507056029/sugarbrix/teaspoon_sugar.jpg")
        .attr("width", "50")
        .attr("height", "50");

      tr.append("td")
        .append("rect")
        .attr("class", "benchmark")
        .attr("height", "50")
        .attr("width", "100")
        .attr("fill", "url(#bg)");

      let displayedSugar = undefined;

      tr.append("td")
        .attr("class", "sugar-grams")
        .html(f => {
          switch (serving) {
            case "oneServing":
              displayedSugar = f.sugar_per_unit_in_g;
              break;
            case "grams":
              displayedSugar = 100 / f.unit_weight_in_g * f.sugar_per_unit_in_g;
              break;
          }
          return displayedSugar + 'g';
        });

    </script>
  </body>
  </html>
